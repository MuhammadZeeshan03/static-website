<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">
    <meta name="color-scheme" content="light dark">

    
      <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;">

    

    <meta name="author" content="Muhammad Zeeshan">
    <meta name="description" content="Click to view full article">
    <meta name="keywords" content="blog,developer,personal">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Explanation( Click to view )"/>
<meta name="twitter:description" content="Click to view full article"/>

    <meta property="og:title" content="Explanation( Click to view )" />
<meta property="og:description" content="Click to view full article" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://awaisaslam186.github.io/assignment/os/" /><meta property="article:section" content="assignment" />
<meta property="article:published_time" content="2021-04-15T18:11:45&#43;05:00" />
<meta property="article:modified_time" content="2021-04-15T18:11:45&#43;05:00" />



    <title>
  Explanation( Click to view ) · CAO Assignment
</title>

    
      <link rel="canonical" href="https://awaisaslam186.github.io/assignment/os/">
    

    <link rel="preload" href="/fonts/forkawesome-webfont.woff2?v=1.1.7" as="font" type="font/woff2" crossorigin>

    
      
      
      <link rel="stylesheet" href="/css/coder.min.04d6bedce375c4fcb6bf1e2c89e70f9e45a3431f1926a9f5f63749517718d366.css" integrity="sha256-BNa&#43;3ON1xPy2vx4siecPnkWjQx8ZJqn19jdJUXcY02Y=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="/css/coder-dark.min.dde8a61eb31a32353b4baf3d9113f03c4ea2a8ca9bb736f59ca2d2b2cb664f0b.css" integrity="sha256-3eimHrMaMjU7S689kRPwPE6iqMqbtzb1nKLSsstmTws=" crossorigin="anonymous" media="screen" />
      
    

    

    

    <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

    

    <meta name="generator" content="Hugo 0.82.0" />
  </head>

  
  
    
  
  <body class="preload-transitions colorscheme-auto"
        onload=""
  >
    
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      CAO Assignment
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/assignment/">Assignment 1,2,3</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container page">
  <article>
    <header>
      <h1 class="title">
        <a class="title-link" href="https://awaisaslam186.github.io/assignment/os/">
          Explanation( Click to view )
        </a>
      </h1>
    </header>

    <hr>
<h2 id="you-can-find-code-of-64-bit-os-on-my-git-repository">
  You can find code of 64-bit OS on my git repository
  <a class="heading-link" href="#you-can-find-code-of-64-bit-os-on-my-git-repository">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<ul>
<li>(<a href="https://github.com/zeeshan123-ops/OS">https://github.com/zeeshan123-ops/OS</a>)</li>
</ul>
<hr>
<h1 id="here-is-the-explanation">
  Here is the explanation:
  <a class="heading-link" href="#here-is-the-explanation">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>i first built a 32-bit operating system and then converted it into 64-bit.</p>
<h1 id="software-used">
  Software Used:
  <a class="heading-link" href="#software-used">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<pre><code>- Softwares
</code></pre>
<ul>
<li><a href="https://www.docker.com/">Docker</a> for creating our build-environment.</li>
<li><a href="https://qemu.weilnetz.de/w64/">Qemu</a>(To emulate the enviroment )</li>
<li>nasm    ( Installe dby running comands in docker file )</li>
</ul>
<h1 id="docker">
  DOCKER
  <a class="heading-link" href="#docker">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<h2 id="what-is-docker-">
  what is docker ?
  <a class="heading-link" href="#what-is-docker-">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>docker is a tool designed to make it easier to create, deploy , and run application by using conatainer.</p>
<h2 id="container">
  Container:
  <a class="heading-link" href="#container">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>container allow to package up an application with all of the parts it needs, such as libraries and other dependencies, and deploy it as one package.
<strong>By doing so, the we can rest assured that the application will run on any other Linux machine regardless of any customized settings that machine might have that could differ from the machine used for writing and testing the code.</strong>
Its a bit like a virtual machine. But rather than creating a whole virtual operating system, Docker allows application to use the same Linis kernel as the system they are running on.</p>
<h1 id="software-installed-using-docker">
  Software installed using Docker
  <a class="heading-link" href="#software-installed-using-docker">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>i also installed certain softwares using docker.</p>
<pre><code>- Softwares
</code></pre>
<ul>
<li><strong>gcc-cross-x86_64-elf</strong> ( A pre-made image which will hold all compilation tools we need)</li>
<li><strong>nasm</strong> (For compilation of the assembly code)</li>
<li><strong>Grub</strong>(To build our final .iso file )</li>
</ul>
<h1 id="what-is-grub-">
  What is Grub ?
  <a class="heading-link" href="#what-is-grub-">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>GRUB implements a specification called Multiboot, which is a set of conventions for how a kernel should get loaded into memory. By following the Multiboot specification, we can let GRUB load our kernel.</p>
<p>The way that we do this is through a ‘header’. We’ll put some information in a format that multiboot specifies right at the start of our kernel. GRUB will read this information, and follow it to do the right thing.</p>
<h2 id="docker-image">
  Docker Image
  <a class="heading-link" href="#docker-image">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Docker image is like a snapshot of a linux machine with any extra software andfiles installed onto it.</p>
<p>After building a docker image i used a command</p>
<p><code>code</code></p>
<ul>
<li><strong>docker run &ndash;rm -it -v %cd%:/root/env myos-buildenv</strong></li>
</ul>
<p><em>Before running this command make sure that docker daemon is running.</em>
Otherwise it will show error.</p>
<h1 id="issue-faced">
  Issue Faced
  <a class="heading-link" href="#issue-faced">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p><img src="/img/error1.PNG" alt="snap of an error faced"></p>
<p>This is the error that specifies that the docker daemon is not running.</p>
<p>After its proper running im inside a virtual machine with access to all the tools and softwares that i need to build the operating system.</p>
<h1 id="a-snap-of-a-docker-build-image">
  A snap of a docker build image:
  <a class="heading-link" href="#a-snap-of-a-docker-build-image">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p><img src="/img/docker.PNG" alt="snap of a docker image"></p>
<h1 id="issue-faced-1">
  Issue Faced:
  <a class="heading-link" href="#issue-faced-1">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>First of all i faced the issue in the proper downloading of docker version. But its not a technical one.</p>
<p><code>code</code></p>
<ul>
<li><strong>docker build buildenv -t myos-buildenv</strong></li>
</ul>
<p>Next when i run the commad i faced issue that docker daemon is not working well. So, i came to know that docker is not running. i opened the docker and it started working.</p>
<h1 id="qemu">
  QEMU
  <a class="heading-link" href="#qemu">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<h2 id="why-used-">
  Why used ?
  <a class="heading-link" href="#why-used-">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Qemu is used to emulate the image or operating system built by the docker and certain privileged.Its like a hosted virtual machine monitor. It emulates the machine&rsquo;s processor through dynamic binary translation and provides a set of different hardware and device models for the machine, enabling it to run a variety of guest
operating systems.</p>
<p>To Emulate the os in the QEMU the command is</p>
<p><code>code</code></p>
<ul>
<li><strong>qemu-system-x86_64 -cdrom dist/x86_64/kernel.iso</strong></li>
</ul>
<h1 id="headerasm-file">
  Header.asm File
  <a class="heading-link" href="#headerasm-file">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>This file has the code for bootloader to locate the operating system in whatever way it is appropriate for the specific computer.</p>
<ol>
<li>
<h2 id="magic-number-dd-0xe85250d6">
  Magic number (dd 0xe85250d6)
  <a class="heading-link" href="#magic-number-dd-0xe85250d6">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
</li>
</ol>
<p><strong>dd 0xe85250d6 ; magic number</strong></p>
<p>&ldquo;dd&rdquo; stand for define double word.</p>
<p>&ldquo;0xe85250d6&rdquo;
This is a hexadecimal arbitrary number. It does not mean anything. The very first thing that the multiboot specification requires is that we have the magic number
<strong>dd 0xe85250d6</strong> right at the start.</p>
<ol start="2">
<li>
<h2 id="dd-0">
  dd 0
  <a class="heading-link" href="#dd-0">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
</li>
</ol>
<p>This is used to define that we are in the protected mood later we will change this number to 1 which means that now we are using long mood.
infact proected mood and the real mood are used to define weather we are operating a 32 or 64 bit processor respectively.</p>
<ol start="3">
<li>
<h2 id="header_end---header_start">
  header_end - header_start
  <a class="heading-link" href="#header_end---header_start">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
</li>
</ol>
<p>This statment used to define header length.</p>
<ol start="4">
<li>
<h2 id="check-sum">
  Check Sum
  <a class="heading-link" href="#check-sum">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
</li>
</ol>
<p>Here we will do some calculation. Infact the idea is that it lets us and the GRUB double check that everything is accurate.</p>
<ol start="5">
<li>
<h1 id="ending-tag">
  Ending Tag
  <a class="heading-link" href="#ending-tag">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
</li>
</ol>
<ul>
<li>dw 0</li>
<li>dw 0</li>
<li>dd 8</li>
</ul>
<h1 id="mainasm-file">
  Main.asm File
  <a class="heading-link" href="#mainasm-file">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>This file will be the entry point into the system and we are writing the necessary assembly code that we need to print on the screen for our purpose.</p>
<p>In this we first set the system to 32-bit and later converted it to 64-bit.</p>
<h1 id="linkerld-file">
  Linker.ld File
  <a class="heading-link" href="#linkerld-file">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>we create this file to link both the header file and the main.asm file
We’ve now got our kernel in the kernel.bin file. Next, we’re going to make an ISO out of it, so that we can load it up in QEMU</p>
<h1 id="makefile">
  MakeFile
  <a class="heading-link" href="#makefile">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>Typing all of these commands out every time we want to build the project is tiring and error-prone. It’s nice to be able to have a single command that builds our entire project. To do this, we’ll use make. Make is a classic bit of software that’s used for this purpose. At its core, make is fairly simple. We just need to make a <strong>Makefile</strong> . In this we define the values with some rules and whenever we need to build the os we just build this MakeFile. It will work fast.</p>
<p>In this file we created to variables to store data of two different type of files. These files are .asm files and .o files i.e, oblect files.</p>
<p>After this we build  the object file from the source files. We only recompile when the data of source file has been changed.</p>
<p>At the end we generate our iso file using grub-mkrescue and put our output in the kernal.iso file.</p>
<p>After all this we first build the image then emulated it with QEMU and printed the  word  <strong>&ldquo;OK&rdquo;</strong> that we wrote in the assembly file.</p>
<p><img src="/img/Capture.PNG" alt="OK printed on QEMU console"></p>
<p>After this we converted the OS to 64-bit.</p>
<h1 id="process-to-convert-into-64-bit">
  Process to convert into 64-Bit
  <a class="heading-link" href="#process-to-convert-into-64-bit">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>From now we will shift to c language and write our code in the c language. To write in c language we need to implement stack.
In implementing this we will reserve some memory so that when the boot-loader loads our kernel.
We first all implemented this stack in assembly.
Before we move to c code we fisrt implemented long mode (64-bit mode) and changed our kernel to 64-bit.</p>
<p>After that we initilize many subroutines to check different parameters. First we all we check that our multoboot2 loader is loaded successfully.
Similarly we created function to check for cpuid which gives various cpu information. Which further help to check wether our system is compatible for 64-bit mode or not.Here we use the previous implemented stack to check that weather the system is compatible or not.
After this we implemented a new concept called pagging.</p>
<h1 id="paging">
  Paging
  <a class="heading-link" href="#paging">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>All our data in memory is stored at different addresses. However rather than working directly with the physical addresses in ram we work with virtual addresses.Which provides a very useful layer of indirection.physical addresses and virtual addresses. A <strong>physical address</strong> is the actual, real value of a location in the physical RAM in the machine. A <strong>virtual address</strong> is an address anywhere inside of our 64-bit address space: the full range. To bridge between the two address spaces, we can map a given virtual address to a particular physical address. Which can be done with the help of this paging concept.So to enter into long mode i.e., 64-bit mode we need to impliment this process of paging.<br>
In the simplest form paging allows us to map virtual addresses to physical addresses. we do this by creating page tble defining all the mappings which the system then looks at whenever we read or write to memory.</p>
<p>A single page is a chunk of 4KB of memory. When we a mapping memory we map a full page of virtual memory to physical memory at a time.There are four level of page table.These are called L1,L2,L3 and L4. Each table can hold 512 entries. Each virtual address take 48bits of 64bits available. The other bits are actually unused.</p>
<h1 id="global-descripter-table">
  Global Descripter Table
  <a class="heading-link" href="#global-descripter-table">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>Although we have implemented long mode in paging but we are not in 64-bit mode. We are still in 32-bit compatible sub mode. To finally finish 64-bit mode we need to implement that is called global descripter table. Although we are using paging the global descripter table has less work but it is still required to enter into 64-bit mode.</p>
<p>Our Global descripter table has three entries.</p>
<ul>
<li>Zero Entry</li>
<li>Code Segment</li>
<li>Data Segment</li>
</ul>
<h2 id="zero-entry">
  Zero Entry
  <a class="heading-link" href="#zero-entry">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<pre><code>- code
</code></pre>
<p>{
section .rodata</p>
<p>gdt64:</p>
<p>dq 0}</p>
<p>We have a new section: <strong>.rodata</strong>. This stands for ‘read only data’ and since we are not going to modify our Global descriper table, having it be read-only is a good idea.Next, we have a label: <strong>gdt64</strong>. We will use this label later to tell the hardware where our Global descriper table is located.
Finally, dq 0. This is define quad-word in other words a 64-bit value. Given that it’s a zero entry.</p>
<h2 id="code-segment">
  Code Segment.
  <a class="heading-link" href="#code-segment">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<pre><code>- code 
.code: equ $ - gdt64
dq (1&lt;&lt;44) | (1&lt;&lt;47) | (1&lt;&lt;41) | (1&lt;&lt;43) | (1&lt;&lt;53)
</code></pre>
<p>1&laquo;44 means ‘left shift one 44 places’, which sets the 44th bit and so on for all other instruction.</p>
<ul>
<li>( set 44 &lsquo;TO set descriptor type&rsquo;)</li>
<li>( set 47 &lsquo;present&rsquo; this is set if the entry is valid)</li>
<li>( set 41 &lsquo;read/write command&rsquo; If this is code segment then it is readable.)</li>
<li>( set 43 &lsquo;Executable&rsquo; set to 1 for code segment)</li>
<li>( set 53 for 64-bit GDT this should be 1).</li>
</ul>
<h1 id="printh-file">
  Print.h File
  <a class="heading-link" href="#printh-file">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>After implementing the above all code we are now going to define our c file. Here we will define our own methods for printing data or other values.like here we defined the function to clear the screen, print_src() (to print value) and print_char() etc.
We also defined a function to change the foreground and background color.
Here we also defined an ENUM to give a specific value to a color.</p>
<h1 id="updates-in-the-makefile">
  Updates in the Makefile:
  <a class="heading-link" href="#updates-in-the-makefile">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>We again updated the Makefile and edited the Makefile to read the c and kernal files. Before this it was only compiling and linking the .asm file.</p>
<p>After all this we have succcessfully converted our 32 bit operating system to 64-bit OS. And now we are ready to print the output.</p>
<h1 id="output">
  Output.
  <a class="heading-link" href="#output">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>To print the desired output. I used loops instead of hard code.
i had my previous project so i used that logic to print the desired output.</p>
<p><img src="/img/nust.PNG" alt="Output Image"></p>
<h1 id="conclusion">
  Conclusion:
  <a class="heading-link" href="#conclusion">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>I learned soo many things from this assignment. Like now i have a idea how to built a 32 bit processor and then convert it to 64-bit.Secondly i learned how to build a static website. I was not a github user,but now i learned that how to use github make repo and upload a code over it. I also came to know that how to host a site over the server.</p>
<p>Firstly i was against this assignment. But now i&rsquo;m happy that i&rsquo;ve completed it successfully and within time :)</p>

  </article>
</section>

  

      </div>

      
  <footer class="footer">
    <section class="container">
      
        <p> Site Credits | Muhammad Awais Shah</p>
      
      
        ©
        
          2019 -
        
        2021
         Muhammad Zeeshan 
      
      
         · 
        Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
      
      
    </section>
  </footer>


    </main>

    
      
      <script src="/js/coder.min.235666b114443867d43eeb5799d51f6252965e5163f338285e113fa381d3d27e.js" integrity="sha256-I1ZmsRREOGfUPutXmdUfYlKWXlFj8zgoXhE/o4HT0n4="></script>
    

    

    

    

    

    

    

    

    
  </body>

</html>
